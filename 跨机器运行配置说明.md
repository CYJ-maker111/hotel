# 跨机器运行配置说明

## 功能说明

现在系统支持客户端和服务端在不同的电脑上运行！

## 配置方法

### 方案1：客户端和服务端在同一台电脑（默认）

**无需配置**，直接运行即可：

```bash
# 服务端
python backend_app.py

# 客户端
浏览器打开：http://127.0.0.1:5000
或打开：http://127.0.0.1:5000/client/room_remote.html
```

### 方案2：客户端和服务端在不同电脑

#### 步骤1：配置服务端

**服务端电脑**：

1. 启动服务端：
```bash
python backend_app.py
```

2. 查看服务端IP地址：
   - Windows: `ipconfig`
   - Linux/Mac: `ifconfig` 或 `ip addr`
   
   例如：`192.168.1.100`

3. 确保防火墙允许5000端口：
   - Windows: 在防火墙设置中添加5000端口例外
   - Linux: `sudo ufw allow 5000` 或配置iptables

#### 步骤2：配置客户端

**客户端电脑**：

**方法A：通过URL参数配置（推荐）**

在浏览器中打开：
```
http://服务端IP:5000/client/room_remote.html?api=http://服务端IP:5000/api
```

例如：
```
http://192.168.1.100:5000/client/room_remote.html?api=http://192.168.1.100:5000/api
```

**方法B：直接访问服务端提供的页面**

如果客户端能访问服务端，直接打开：
```
http://服务端IP:5000
```

这样前端会自动使用正确的API地址。

**方法C：修改客户端文件（不推荐）**

编辑 `client/room_remote.html`，修改：
```javascript
const API_BASE_URL = 'http://服务端IP:5000/api';
```

例如：
```javascript
const API_BASE_URL = 'http://192.168.1.100:5000/api';
```

## 网络架构

### 同一台电脑
```
┌─────────────────────┐
│  客户端（浏览器）    │
│  http://127.0.0.1   │
└──────────┬──────────┘
           │
           │ localhost
           │
┌──────────▼──────────┐
│  服务端（Flask）     │
│  host=0.0.0.0:5000  │
└─────────────────────┘
```

### 不同电脑
```
┌─────────────────────┐
│  客户端电脑          │
│  浏览器              │
│  192.168.1.50       │
└──────────┬──────────┘
           │
           │ HTTP请求
           │ 192.168.1.100:5000
           │
┌──────────▼──────────┐
│  服务端电脑          │
│  Flask Server       │
│  192.168.1.100:5000 │
│  host=0.0.0.0       │
└─────────────────────┘
```

## 修改内容

### 1. 后端修改（backend_app.py）

```python
# 修改前
app.run(debug=True)  # 只监听localhost

# 修改后
app.run(host='0.0.0.0', port=port, debug=True)  # 监听所有网络接口
```

**说明**：
- `host='0.0.0.0'`：监听所有网络接口，允许其他电脑访问
- `port=5000`：默认端口，可通过环境变量PORT修改

### 2. 客户端修改（room_remote.html）

```javascript
// 修改前
const API_BASE_URL = 'http://127.0.0.1:5000/api';  // 硬编码

// 修改后
const urlParams = new URLSearchParams(window.location.search);
const API_BASE_URL = urlParams.get('api') || 'http://127.0.0.1:5000/api';
```

**说明**：
- 支持通过URL参数配置API地址
- 默认使用localhost（向后兼容）

## 使用示例

### 示例1：服务端在192.168.1.100

**服务端**：
```bash
# 在192.168.1.100上运行
python backend_app.py
# 输出：Running on http://0.0.0.0:5000
```

**客户端**：
```bash
# 在另一台电脑的浏览器中打开
http://192.168.1.100:5000
# 或
http://192.168.1.100:5000/client/room_remote.html?api=http://192.168.1.100:5000/api
```

### 示例2：自定义端口

**服务端**：
```bash
# 使用环境变量设置端口
PORT=8080 python backend_app.py
# 或
set PORT=8080  # Windows
python backend_app.py
```

**客户端**：
```
http://192.168.1.100:8080
```

## 防火墙配置

### Windows防火墙

1. 打开"Windows Defender 防火墙"
2. 点击"高级设置"
3. 入站规则 → 新建规则
4. 选择"端口" → TCP → 特定本地端口：5000
5. 允许连接 → 完成

### Linux防火墙

```bash
# Ubuntu/Debian
sudo ufw allow 5000

# CentOS/RHEL
sudo firewall-cmd --add-port=5000/tcp --permanent
sudo firewall-cmd --reload
```

## 安全注意事项

⚠️ **开发环境**：
- `debug=True` 仅用于开发
- 生产环境应设置 `debug=False`

⚠️ **网络安全**：
- 确保防火墙配置正确
- 不要在生产环境暴露到公网
- 建议使用内网IP地址

## 测试方法

### 1. 测试服务端是否可访问

在客户端电脑上：
```bash
# 测试连接
curl http://服务端IP:5000/api/rooms

# 或使用浏览器访问
http://服务端IP:5000
```

### 2. 测试客户端功能

1. 在客户端电脑打开 `room_remote.html`
2. 选择房间
3. 尝试开机、调温等操作
4. 检查是否能正常控制

## 常见问题

### Q1: 连接被拒绝

**原因**：防火墙阻止或服务端未启动

**解决**：
1. 检查服务端是否运行
2. 检查防火墙设置
3. 检查IP地址是否正确

### Q2: 跨域错误（CORS）

**原因**：浏览器安全策略

**解决**：前端使用相对路径，服务端已配置CORS（如果需要）

### Q3: 找不到API

**原因**：API地址配置错误

**解决**：检查URL参数或API_BASE_URL配置

## 修改的文件

1. `backend_app.py` - 修改为监听0.0.0.0
2. `client/room_remote.html` - 支持URL参数配置API地址
3. `hotel/hotel/backend_app.py` - 同步更新

## 更新日期
2025年

